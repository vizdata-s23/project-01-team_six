---
title: "Investigating America's Most Reputable Companies"
subtitle: "STA/ISS 313 - Spring 2023 - Project 1"
author: "Team Six: George McCabe, Shelby Tisdale, Florence Wang, Chris Yang"
title-slide-attributes:
  data-background-size: stretch
  data-slide-number: none
format: revealjs
editor: visual
execute:
  echo: false
---

```{r}
#| label: load-packages
#| include: false

# Add any additional packages you need to this chunk
# Remove any packages from this list that you're not using
library(tidyverse)
library(tidymodels)
library(gt)
library(patchwork)
library(gganimate)
library(ggcorrplot)

```

```{r}
#| label: setup
#| include: false

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618, 
  out.width = "70%"
  )
```

```{r}
#| label: load-data
#| include: false

poll <- read.csv("data/polls.csv")
reputation <- read.csv("data/reputation.csv")
```

# Investigating America's Most Reputable Companies

## Introduction to Dataset and Motivation

-   The presentation is created using the Quarto CLI

-   `##` sets the start of a new slide

## Question 1: How do customer ratings of company attributes vary by industry and how do these attributes relate to one another?

### Visualization #1

```{r}
#| label: data wrangling q1v1
#| echo: false
#data wrangling
reputation1 <- reputation |>
  group_by(industry, name) |>
  mutate(avg_score = mean(score))
reputation2 <- reputation1 |>
  group_by(name) |>
  mutate(maxavg = max(avg_score))

#used to confirm which industries were the highest scored in each category
overview <- reputation1 |>
  group_by(name) |>
  slice(which.max(avg_score))

#creating dataframes for each attribute based on which industry had the highest average
citizenship <- reputation2 |>
  group_by(name) |>
  filter(name == "CITIZENSHIP" & avg_score == maxavg)
culture <- reputation2 |>
  group_by(name) |>
  filter(name == "CULTURE" & avg_score == maxavg)
ethics <- reputation2 |>
  group_by(name) |>
  filter(name == "ETHICS" & avg_score == maxavg)
growth <- reputation2 |>
  group_by(name) |>
  filter(name == "GROWTH" & avg_score == maxavg)
ps <- reputation2 |>
  group_by(name) |>
  filter(name == "P&S" & avg_score == maxavg)
trust <- reputation2 |>
  group_by(name) |>
  filter(name == "TRUST" & avg_score == maxavg)
vision <- reputation2 |>
  group_by(name) |>
  filter(name == "VISION" & avg_score == maxavg)

final <- rbind(citizenship, culture, ethics, growth, ps, trust, vision)
```

```{r}
#| label: q1v1 plot
#| echo: false
get_box_stats <- function(y, upper_limit = max(final$score) * 1.15) {
  return(data.frame(
    y = 0.95 * upper_limit,
    label = paste(
      "Mean =", round(mean(y), 2), "\n",
      "Med =", round(median(y), 2), "\n"
    )
  ))
}
ggplot(final, aes(x = name, y = score, fill = industry)) +
  geom_boxplot(fatten = 0.8) +
  labs(title = "Highest Rated Industries In Each Attribute Category", x = "Company Attribute", y = "Score", fill = "Industry") +
  scale_fill_manual(values = c("#4ea5e3", "#ce0e5b", "#1aaf82")) +
  stat_summary(fun.data = get_box_stats, geom = "text", hjust = 0.5, vjust = 0.9, size = 2.6) +
  theme_minimal() 
```

## Question 1 Continued

### Visualization #2

```{r}
#| label: data wrangling q1 v2
#| echo: false

reputation_longer <- reputation |>
  select(company, name, score, industry) |>
  pivot_wider(
    names_from = name,
    values_from = score
  )

reputation_longer <- reputation_longer |>
  rename("Trust" = "TRUST",
         "Ethics" = "ETHICS",
         "Growth" = "GROWTH",
         "Citizenship" = "CITIZENSHIP",
         "Vision" = "VISION",
         "Culture" = "CULTURE")

attributes_corr <- reputation_longer |>
  as.data.frame() |>               
  select(Trust, Ethics, Growth, `P&S`, Citizenship, Vision, Culture) |>                   
  as.matrix() |>                   
  cor() 
attributes_p_values <- cor_pmat(attributes_corr)
```

```{r}
#| label: q1v2 plot
#| echo: false
#| warning: false
#| fig-alt: |
#|   Body mass vs. flipper lenght of Palmer Penguins for species Adelie and all 
#|   the others combined together. There is a relatively strong, positive 
#|   relationship between the two variables. The Adelie penguins are clustered 
#|   together but they don't exhibit a different trend than the rest of the 
#|   penguins.

ggcorrplot(attributes_corr,
           type = "lower",
           method = "circle",
           show.legend = TRUE,
           legend.title = "Correlation Coefficent",
           p.mat = attributes_p_values,
           colors = c("#ce0e5b", "white", "#4ea5e3")) + 
  annotate("text",
           x = 2.7, y = 6, 
           color = "#b320ab", size = 3.8,
           label = "Size of circle indicates 
strength of positive correlation") +
    annotate("text",
           x = 2.7, y = 5, 
           color = "#1aaf82", size = 3.8,
           label = "X's indicate no significant 
relationship (alpha > 0.05)") +
  labs(
    title = "Correlation Matrix of Company Attributes",
    subtitle = "Attribute scores from 2022"
  ) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

## Question 2: How does company RQ score change between the years of 2017 to 2022 and are the trends consistent with their overall industry?

### Visualization #1

### 

## Question 2 Continued

### Visualization #2

```{r}

```
